<!-- 

	VM Details Pane
	Copyright (C) 2011 Ian Moore (imoore76 at yahoo dot com)
	
	$Id$

 -->
<div id='vboxTabVMDetails' style='height: 100%; width: 100%; display: none;' class='vboxInvisible'>
	<div id='vboxHostDetails' class='vboxInvisible' style='display: none'></div>
	<div id='vboxDetailsVMInaccessible' class='vboxInvisible' style='display: none'></div>
	<div id='vboxVMDetails' style='height: 100%; display: none' class='vboxInvisible'>
		<table class='vboxInvisible' style='width: 100%;'>
			<tr style='vertical-align: top'>
				<td style='width:100%'>
					<table id='vboxDetailsTableBoxGeneral' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
						<tr class='vboxDetailsHead'>
							<th class='vboxDetailsSection' colspan='2'>
								<div>
									<img style='float:left;  margin-right: 3px;' src='images/vbox/machine_16px.png' />
									<span style='float:left'><a href="javascript:vboxDetailSettingsLink('General')" class='translate'>General</a></span>
									<span class='vboxDetailsUpDnImgSpan' style='float:right'>
										<img src='images/arrow_grad_up.png' />
									</span>
								</div>
							</th>
						</tr>
					</table>
					<table id='vboxDetailsTableBoxSystem' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
						<tr class='vboxDetailsHead'>
						<th class='vboxDetailsSection' colspan='2'>
							<div>
								<img style='float:left;  margin-right: 3px;' src='images/vbox/chipset_16px.png' />
								<span style='float:left'><a href="javascript:vboxDetailSettingsLink('System');" class='translate'>System</a></span>
								<span class='vboxDetailsUpDnImgSpan' style='float:right'>
									<img src='images/arrow_grad_up.png' />
								</span>
							</div>
						</th>
						</tr>
					</table>
				</td>
				<td id='vboxDetailsTableBoxPreviewSpacer'>
					<!-- Spacer -->
				<td>
				</td>
				<td>
					<table id='vboxDetailsTableBoxPreview' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
						<tr class='vboxDetailsHead'>
							<th class='vboxDetailsSection' colspan='2'>
								<div>
									<img style='float:left;  margin-right: 3px;' src='images/vbox/fullscreen_16px.png' />
									<span style='float:left' class='translate'>Preview</span>
									<span class='vboxDetailsUpDnImgSpan' style='float:right'>
										<img src='images/arrow_grad_up.png' />
									</span>
								</div>
							</th>
						</tr>
						<tr style='vertical-align: middle'>
							<td style='text-align: center' colspan='2'>
								<table class='vboxInvisible' align='center' style='margin-left:auto;margin-right:auto;'>
									<tr style='vertical-align:bottom; padding:0px; margin:0px;'>
										<td class='vboxInvisible' style='text-align:right'><img src='images/monitor_tl.png' style='width:15px;height:17px;'/></td>
										<td class='vboxInvisible'><img src='images/monitor_top.png' class='vboxPreviewMonitor' style='height:17px;'/></td>
										<td class='vboxInvisible' style='text-align:left'><img src='images/monitor_tr.png' style='width:15px;height:17px;'/></td>
									</tr>
									<tr>
										<td class='vboxInvisible' style='text-align:right'><img src='images/monitor_left.png' style='width:15px;' class='vboxPreviewMonitorSide' /></td>
										<td class='vboxInvisible'><div id='vboxDetailsPreviewWrap' style='text-align:center;background-color:#000;border:0px;display:table;#position:relative;background-repeat: no-repeat;padding:0px;margin:0px;'>
										</div></td>
										<td class='vboxInvisible' style='text-align:left' ><img src='images/monitor_right.png' style='width:14px;' class='vboxPreviewMonitorSide' /></td>
									</tr>
									<tr style='vertical-align:top;'>
										<td class='vboxInvisible' style='text-align:right'><img src='images/monitor_bl.png' style='width:15px;height:17px;'/></td>
										<td class='vboxInvisible'><img src='images/monitor_bottom.png' class='vboxPreviewMonitor' style='height:17px;'/></td>
										<td class='vboxInvisible' style='text-align:left'><img src='images/monitor_br.png' style='width:15px;height:17px;'/></td>
									</tr>
								</table>													
							</td>
						</tr>
					</table>				
				</td>
			</tr>
		</table>
		
		<!-- Display -->
		<table id='vboxDetailsTableBoxDisplay' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
			<tr class='vboxDetailsHead'>
				<th class='vboxDetailsSection' colspan='2'>
					<div>
						<img style='float:left;  margin-right: 3px;' src='images/vbox/fullscreen_16px.png' />
						<span style='float:left'><a href='javascript:vboxDetailSettingsLink("Display");' class='translate'>Display</a></span>
						<span class='vboxDetailsUpDnImgSpan' style='float:right'>
							<img src='images/arrow_grad_up.png' />
						</span>
					</div>
				</th>
			</tr>
		</table>

		<!-- Storage -->
		<table id='vboxDetailsTableBoxStorage' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
			<tr class='vboxDetailsHead'>
				<th class='vboxDetailsSection' colspan='2'>
					<div>
						<img style='float:left;  margin-right: 3px;' src='images/vbox/hd_16px.png' />
						<span style='float:left'><a href="javascript:vboxDetailSettingsLink('Storage');" class='translate'>Storage</a></span>
						<span class='vboxDetailsUpDnImgSpan' style='float:right'>
							<img src='images/arrow_grad_up.png' />
						</span>
					</div>
				</th>
			</tr>		
		</table>
			
		<!-- Audio -->
		<table id='vboxDetailsTableBoxAudio' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
			<tr class='vboxDetailsHead'>
				<th class='vboxDetailsSection' colspan='2'>
					<div>
						<img style='float:left;  margin-right: 3px;' src='images/vbox/sound_16px.png' />
						<span style='float:left'><a href="javascript:vboxDetailSettingsLink('Audio');" class='translate'>Audio</a></span>
						<span class='vboxDetailsUpDnImgSpan' style='float:right'>
							<img src='images/arrow_grad_up.png' />
						</span>
					</div>
				</th>
			</tr>		
		</table>

		<!-- Network -->
		<table id='vboxDetailsTableBoxNetwork' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
			<tr class='vboxDetailsHead'>
				<th class='vboxDetailsSection' colspan='2'>
					<div>
						<img style='float:left;  margin-right: 3px;' src='images/vbox/nw_16px.png' />
						<span style='float:left'><a href="javascript:vboxDetailSettingsLink('Network');" class='translate'>Network</a></span>
						<span class='vboxDetailsUpDnImgSpan' style='float:right'>
							<img src='images/arrow_grad_up.png' />
						</span>
					</div>
				</th>
			</tr>
		</table>

		<!-- SerialPorts -->
		<table id='vboxDetailsTableBoxSerialPorts' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
			<tr class='vboxDetailsHead'>
				<th class='vboxDetailsSection' colspan='2'>
					<div>
						<img style='float:left;  margin-right: 3px;' src='images/vbox/serial_port_16px.png' />
						<span style='float:left'><a href="javascript:vboxDetailSettingsLink('SerialPorts');" class='translate'>Serial Ports</a></span>
						<span class='vboxDetailsUpDnImgSpan' style='float:right'>
							<img src='images/arrow_grad_up.png' />
						</span>
					</div>
				</th>
			</tr>
		</table>

		<!-- USB -->
		<table id='vboxDetailsTableBoxUSB' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
			<tr class='vboxDetailsHead'>
				<th class='vboxDetailsSection' colspan='2'>
					<div>
						<img style='float:left;  margin-right: 3px;' src='images/vbox/usb_16px.png' />
						<span style='float:left'><a href="javascript:vboxDetailSettingsLink('USB');" class='translate'>USB</a></span>
						<span class='vboxDetailsUpDnImgSpan' style='float:right'>
							<img src='images/arrow_grad_up.png' />
						</span>
					</div>
				</th>
			</tr>
		</table>

		<!-- Shared Folders -->
		<table id='vboxDetailsTableBoxSharedFolders' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
			<tr class='vboxDetailsHead'>
				<th class='vboxDetailsSection' colspan='2'>
					<div>
						<img style='float:left;  margin-right: 3px;' src='images/vbox/shared_folder_16px.png' />
						<span style='float:left'><a href="javascript:vboxDetailSettingsLink('SharedFolders');" class='translate'>Shared Folders</a></span>
						<span class='vboxDetailsUpDnImgSpan' style='float:right'>
							<img src='images/arrow_grad_up.png' />
						</span>
					</div>
				</th>
			</tr>
		</table>

		<!-- Description -->
		<table id='vboxDetailsTableBoxDescription' class='vboxDetailsTable vboxDetailsTableBox ui-corner-all'>
			<tr class='vboxDetailsHead'>
				<th class='vboxDetailsSection' colspan='2'>
					<div>
						<img style='float:left;  margin-right: 3px;' src='images/vbox/description_16px.png' />
						<span style='float:left'><a href="javascript:vboxDetailSettingsLink('General:2');" class='translate'>Description</a></span>
						<span class='vboxDetailsUpDnImgSpan' style='float:right'>
							<img src='images/arrow_grad_up.png' />
						</span>
					</div>
				</th>
			</tr>
		</table>
	
	</div>
	<!-- Loading... -->
	<div id='vboxDetailsLoading' class='vboxInvisible' style='#position:absolute;#top:50%;display:none;vertical-align:middle;width:100%;height:100%;padding:0px;margin:0px'>
		<div style='#position:relative;#top:-50%;padding:4px;text-align:center;width:100%'>
			<span class='ui-corner-all translate' style='padding:8px;background:#fff;border:2px solid #ddd'>Loading ...</span>
		</div>
	</div>
	<!-- Welcome -->
	<div id='vboxDetailsWelcome' class='vboxBordered' style='#position:absolute;#top:50%;display:none;vertical-align:middle;width:50%;height:50%;text-align:center'>
		<div style='#position:relative;#top:-50%;padding:0px;text-align:center;width:100%'>
			<img src='images/vbox/welcome.png' />
		</div>
	</div>
	
<script type='text/javascript'>

// Cookies used for show/hide boxes
vboxParseCookies();

// Listen for events
/////////////////////////////
$('#vboxTabVMDetails').parent().bind('vmloading',function(){

	// Clear timer if it is set
	if($('#vboxVMDetails').data('vboxPreviewTimer')) {
		window.clearTimeout($('#vboxVMDetails').data('vboxPreviewTimer'));
		$('#vboxVMDetails').data('vboxPreviewTimer', null);
	}

	// Hide any menus that may be showing on this pane
	$('#vboxDetailsShowMenu').hide();
	$('#vboxDetailsPreviewMenu').hide();

	// Hide all tab children first
	$('#vboxTabVMDetails').children().hide();

	if($('#vboxTabVMDetails').css('display') != 'none')
		$('#vboxTabVMDetails').css('display','table');
	
	$('#vboxDetailsLoading').show().css('display','table-cell');


}).bind('vmloaded',function(e,vm){

	// Hide any menus that may be showing on this pane
	$('#vboxDetailsShowMenu').hide();
	$('#vboxDetailsPreviewMenu').hide();

	// Hide all tab children first
	$('#vboxTabVMDetails').children().hide();
	
	$('#vboxVMDetails').data('vmusb', false);
	
	// vboxTabVMDetails
	if(vm && vm.id) {
		
		$('#vboxVMDetails').css({'vertical-align':'top'});

		if(vm.id == 'host') {

			// Clear timer if it is set
			if($('#vboxVMDetails').data('vboxPreviewTimer')) {
				window.clearTimeout($('#vboxVMDetails').data('vboxPreviewTimer'));
				$('#vboxVMDetails').data('vboxPreviewTimer', null);
			}

			__vboxDisplayHostDetailsData(vm);
			
		} else {
			$('#vboxVMDetails').data('vmusb',(vm['USBController'] && vm['USBController']['enabled']));
			__vboxDisplayDetailsData(vm,null,true,true);
		}
			
	} else {

		// Hide all tab children first
		$('#vboxTabVMDetails').css({'display':'table','width':'100%'}).children().hide();

		$('#vboxDetailsWelcome').show().css('display','table-cell');

	
	}
});

// Collapsable sections and link translations
///////////////////////////////////////////////
$('#vboxVMDetails').find('tr.vboxDetailsHead').each(function(){
	$(this).children('th').first().dblclick(function(e){
		if($(this).data('vboxHidden')) {
			$(this).removeClass('vboxDetailsSectionCollapsed');
			$(this).parent().siblings().css('display','');
			$(this).data('vboxHidden',false);
			var src = 'images/arrow_grad_up.png';
		} else {
			$(this).addClass('vboxDetailsSectionCollapsed');
			$(this).parent().siblings().css('display','none');
			$(this).data('vboxHidden',true);
			var src = 'images/arrow_grad_dn.png';				
		}
		$(this).find('span.vboxDetailsUpDnImgSpan').children('img').attr('src',src);
		e.stopPropagation();
		e.preventDefault();				
		return false;
	}).hover(function(){
		$(this).addClass('hover');},
		function(){$(this).removeClass('hover');}
	).bind('onselectstart',function(e){
		e.stopPropagation();
		e.preventDefault();				
		return false;
	}).bind('onmousedown',function(e){
		e.stopPropagation();
		e.preventDefault();								
		return false;
	}).attr('unselectable','on').css('MozUserSelect','none').find('*').attr('unselectable','on').css('MozUserSelect','none');
}).find('.translate').html(function(i,h){return trans(h);}).removeClass('translate');

// translate loading
$('#vboxDetailsLoading').find('.translate').html(function(i,h){return trans(h);}).removeClass('translate');

// Set preview box width
// Make sure previewWidth is set
if(!$('#vboxIndex').data('vboxConfig')['previewWidth'])
	$('#vboxIndex').data('vboxConfig')['previewWidth'] = 180;

$('#vboxDetailsTableBoxPreview').css('min-width',$('#vboxIndex').data('vboxConfig')['previewWidth']+'px');

								
// Returns link to settings
function vboxDetailSettingsLink(section) {
	if($('#vboxIndex').data('selectedVM').sessionState == 'Unlocked' && $('#vboxIndex').data('selectedVM').state != 'Saved') {
		vboxVMsettingsInit($('#vboxIndex').data('selectedVM').id,function(){$('#vboxIndex').trigger('vmselect',[$('#vboxIndex').data('selectedVM')]);},section);
	} else if($('#vboxIndex').data('selectedVM').state == 'Running') {
		
		// Special case for USB
		if(section == 'USB' && !$('#vboxVMDetails').data('vmusb')) return;
		
		if(window['vboxVMsettingsInit' + section])
			window['vboxVMsettingsInit' + section]($('#vboxIndex').data('selectedVM').id,function(){$('#vboxIndex').trigger('vmselect',[$('#vboxIndex').data('selectedVM')]);});
	}
}

//Returns table row (tr) element for details header
function __vboxDetailHeader(icon,name,linkto,vm,boxes) {

	var tr = document.createElement('tr');
	tr.setAttribute('class','vboxDetailsHead');
	var th = document.createElement('th');
	$(th).attr({'class':'vboxDetailsSection','colspan':'2'});

	if(boxes) {
		var div = document.createElement('div');
		div.innerHTML = "<img style='float:left; margin-right: 3px; ' src='images/vbox/" + icon + "' /> ";
	} else {	
		th.innerHTML = "<img style='float:left; margin-right: 3px; ' src='images/vbox/" + icon + "' /> ";
	}
	
	var sp = document.createElement('span');
	$(sp).css({'float':'left'}).append(document.createTextNode(trans(name)+' '));

	if(boxes) {
		$(div).append(sp);
		$(th).append(div);
	} else {
		$(th).append(sp);
	}
	$(tr).append(th);

	return tr;
}

//Base function that returns a table row of machine detail data
//Called from other functions
function __vboxDetailRowReal(name,value,cssClass,html) {
	var tr = document.createElement('tr');
	tr.setAttribute('class','vboxDetailRow');
	var th = document.createElement('th');
	if(html)
		$(th).html(name + (value && value.length && name.length ? ':' : ''));
	else
		$(th).append(document.createTextNode(name + (value && value.length && name.length ? ':' : '')));
	th.setAttribute('class','vboxDetailContent ' + cssClass);
	
	var td = document.createElement('td');
	td.setAttribute('class','vboxDetailsValue');
	if(html) {
		td.innerHTML = value;
	} else { 
		$(td).append(document.createTextNode(value));
	}
	$(tr).append(th);
	$(tr).append(td);

	return tr;
}
//Return normal detail row
function __vboxDetailRow(name,value,html) {
	return __vboxDetailRowReal(name,value,'vboxDetailName',html);
}
//Return indented detail row
function __vboxDetailRowIndented(name,value,html) {
	return __vboxDetailRowReal(name,value,'vboxDetailNameIndent',html);
}

// Draw preview scren
var __vboxDrawPreviewImg = null;

function __vboxDrawPreview(fromSelf) {

	if(!fromSelf && $('#vboxVMDetails').data('vboxPreviewTimer')) {
		window.clearTimeout($('#vboxVMDetails').data('vboxPreviewTimer'));
		$('#vboxVMDetails').data('vboxPreviewTimer', null);
	}
			
	$(__vboxDrawPreviewImg).empty().remove();
	var w = $('#vboxIndex').data('vboxConfig')['previewWidth'];
	__vboxDrawPreviewImg = document.createElement('img');
	__vboxDrawPreviewImg.onload = function(){
		
		// Error or machine not running
		if(this.height <= 1) {

			$('#vboxDetailsPreviewImg').css({'display':'none'}).attr('src','about:blank');
			$('#vboxDetailsPreviewVMName').css('display','');
			
			var width = $('#vboxIndex').data('vboxConfig')['previewWidth'];
			var height = (width * 3.0/4.0);
			
			// Clear timer if it is set
			if($('#vboxVMDetails').data('vboxPreviewTimer')) {
				window.clearTimeout($('#vboxVMDetails').data('vboxPreviewTimer'));
				$('#vboxVMDetails').data('vboxPreviewTimer', null);
			}
			
			
		} else {


			// Calculate height based on width
			var width = $('#vboxIndex').data('vboxConfig')['previewWidth'];
			var factor = width / this.width;
			if(!factor) factor = 1;
			var height = this.height * factor;
			
			$('#vboxDetailsPreviewVMName').css('display','none');
			$('#vboxDetailsPreviewImg').css({'display':'','height':height+'px','width':width+'px'});
			if($.browser.msie)
				$('#vboxDetailsPreviewImg').css({"filter":"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', src='"+this.src+"', sizingMethod='scale')"});
			else
				$('#vboxDetailsPreviewImg').css({'background':'url('+this.src+') top left no-repeat','-moz-background-size':'100% 100%','background-size':'100% 100%','-webkit-background-size':'100% 100%'});

			// Keep refreshing preview if VM is running
			if($('#vboxIndex').data('selectedVM').state == 'Running') {
				$('#vboxVMDetails').data('vboxPreviewTimer',window.setTimeout(function(){
					__vboxDrawPreview(true);
				},$('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] * 1000));
			}
			
		}
		$('#vboxDetailsPreviewWrap').css({'height':height+'px','width':width+'px'});
		$('#vboxDetailsTableBoxPreview').find('img.vboxPreviewMonitor').css('width',width+'px');
		$('#vboxDetailsTableBoxPreview').find('img.vboxPreviewMonitorSide').css('height',height+'px');
	};

	// Update disabled? State not Running or Saved
	if($('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] == 0 || ($('#vboxIndex').data('selectedVM').state != 'Running' && $('#vboxIndex').data('selectedVM').state != 'Saved')) {
		__vboxDrawPreviewImg.height = 0;
		__vboxDrawPreviewImg.onload();
	} else {
		// Running VMs get random numbers. Saved are based on last state change.
		// Try to let the browser cache Saved screen shots
		if($('#vboxIndex').data('selectedVM').state == 'Running') {
			var randid = Math.random(); 
		} else {
			var randid = $('#vboxIndex').data('selectedVM').lastStateChange;
		}
		__vboxDrawPreviewImg.src = 'screen.php?width='+(w)+'&vm='+$('#vboxIndex').data('selectedVM').id+'&randid='+randid;
	}

}
//Display details data table for VM
//////////////////////////////////
function __vboxDisplayDetailsData(data,targetdiv,links,boxes) {

	
	// Defaults
	if(!targetdiv)
		targetdiv = $('#vboxVMDetails');

	if(links === undefined)
		links = true;

	var settings = (links == true && data.sessionState == 'Unlocked' && data.state != 'Saved');

	if(settings) {
		$('#vboxVMDetails').find('th.vboxDetailsSection').children('div').removeClass('vboxNoLinks');
	} else {
		$('#vboxVMDetails').find('th.vboxDetailsSection').children('div').addClass('vboxNoLinks');
	}

	 
	// Accessibility check
	if(data.state == 'Inaccessible') {

		$('#vboxDetailsVMInaccessible').html('').show();
		
		targetdiv = $('#vboxDetailsVMInaccessible');
		
		$(targetdiv).html('<div style="width: 50%">'+trans('VM Inaccessible')+'</div>');
		
		// Details Table
		var vboxDetailsTable = document.createElement('table');
		$(vboxDetailsTable).attr({'style':'width: 50%','class':'vboxDetailsTable vboxDetailsTableError'}).append(__vboxDetailRow(trans("Error"), data.accessError['text'])).append(__vboxDetailRow(trans("Result Code"), data.accessError['resultCode'])).append(__vboxDetailRow(trans("Component"), data.accessError['component'])).appendTo(targetdiv);

		var d = document.createElement('div');
		d.setAttribute('style','width: 50%; padding: 4px;');
		
		var btn = document.createElement('input');
		$(btn).attr({'type':'button',
			'value':trans('Refresh'),
			'style':'background: url(images/vbox/refresh_16px.png) 2px 2px no-repeat; padding: 2px 2px 2px 18px; border: 1px solid #000; background-color: #eee;'
		}).click(function(){
			var l = new vboxLoader();
			l.add('VMDetails',function(){
				$('#vboxIndex').trigger('vmselect',[$('#vboxIndex').data('selectedVM')]);
			},{'vm':$('#vboxIndex').data('selectedVM').id,'force_refresh':1});
			l.run();
		}).appendTo(d);

		$(targetdiv).append(d);
				
		return;
	}


	
	// General
	//////////////////
	if(boxes) {

		var vboxDetailsTable = $('#vboxDetailsTableBoxGeneral');
		$(vboxDetailsTable).find('tr.vboxDetailRow').empty().remove();

		if($('#vboxIndex').data('vboxCookies')["vboxSectionShowGeneral"] == 0) {
			$(vboxDetailsTable).hide();
		} else {
			$(vboxDetailsTable).show();
		}
				
	} else {
		// Enclosing details Table
		var vboxDetailsTable = document.createElement('table');
		$(vboxDetailsTable).attr({'class':'vboxDetailsTable'}).append(__vboxDetailHeader("machine_16px.png","General"));
	}

	$(vboxDetailsTable).append(__vboxDetailRow(trans("Name"), data['name'])).append(__vboxDetailRow(trans("OS Type"), trans(data['OSTypeId'])));
	
	// Guest additions link?
	if(links && data.state == 'Running') {
		$(vboxDetailsTable).append(__vboxDetailRow('', '<a href="javascript:vboxInstallGuestAdditions(\''+data.id+'\')">('+trans('Install Guest Additions')+')</a>',true));
	}



	
	// System
	//////////////////
	if(boxes) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));

		var vboxDetailsTable = $('#vboxDetailsTableBoxSystem');
		$(vboxDetailsTable).find('tr.vboxDetailRow').empty().remove();

		if($('#vboxIndex').data('vboxCookies')["vboxSectionShowSystem"] == 0) {
			$(vboxDetailsTable).hide();
		} else {
			$(vboxDetailsTable).show();
		}

	} else {
		$(vboxDetailsTable).append(__vboxDetailHeader('chipset_16px.png',"System"));
	}
	
	$(vboxDetailsTable).append(__vboxDetailRow(trans("Base Memory"), data['memorySize'] + " " + trans('MB'))).append(__vboxDetailRow(trans("Processors"), data['CPUCount']));
	
	// Boot Order
	var bo = new Array();
	for(var i = 0; i < data['bootOrder'].length; i++) {
		bo[i] = trans(data['bootOrder'][i]);
	}
	$(vboxDetailsTable).append(__vboxDetailRow(trans("Boot Order"), bo.join(trans('LIST_SEP'))));

	// HW advanced config enabled?
	if($('#vboxIndex').data('vboxConfig').enableAdvancedConfig) {
		// Removed. Do we really need this to be displayed?
		// $(vboxDetailsTable).append(__vboxDetailRow(trans("VCPU"), (data['HWVirtExProperties'].Enabled ? trans('Enabled') : trans('Disabled')))).append(__vboxDetailRow(trans("Nested Paging"), (data['HWVirtExProperties'].NestedPaging ? trans('Enabled') : trans('Disabled')))).append(__vboxDetailRow(trans("Large Pages"), (data['HWVirtExProperties'].LargePages? trans('Enabled') : trans('Disabled'))));
	}

	// Preview box
	/////////////////////
	if(boxes) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));

		// Shortcuts
		var divWrap = $('#vboxDetailsPreviewWrap');
		$(divWrap).empty();
		
		var divPreview = $('#vboxDetailsTableBoxPreview');
		var divPreviewSpacer = $('#vboxDetailsTableBoxPreviewSpacer');

		// Set height / width
		var width = $('#vboxIndex').data('vboxConfig')['previewWidth'];
		var height = (width * 3.0/4.0);
		$(divWrap).css({'height':height+'px','width':width+'px','text-align':'left'});
		divPreview.find('img.vboxPreviewMonitor').css('width',width+'px');
		divPreview.find('img.vboxPreviewMonitorSide').css('height',height+'px');
	
		$('<img />').attr({'id':'vboxDetailsPreviewImg','src':'images/monitor_glossy.png'}).css({'display':'none',
			'top':'0px','margin':'0px','border':'0px','padding':'0px',
			'position':'relative','height':height+'px','width':width+'px','float':'left'
		}).appendTo(divWrap);

		// Preview disabled
		if($('#vboxIndex').data('vboxConfig').noPreview) {

			divPreviewSpacer.hide();
			divPreview.hide();
			
		} else {

			if($('#vboxIndex').data('vboxCookies')["vboxSectionShowPreview"] == 0) {
				divPreviewSpacer.hide();
				divPreview.hide();
			} else {
				divPreviewSpacer.show();
				divPreview.show();
			}
			
				
			// Clear timer if it is set
			if($('#vboxVMDetails').data('vboxPreviewTimer')) {
				window.clearTimeout($('#vboxVMDetails').data('vboxPreviewTimer'));
				$('#vboxVMDetails').data('vboxPreviewTimer', null);
			}
			
			var divOut1 = document.createElement('div');
			$(divOut1).attr({'id':'vboxDetailsPreviewVMName','style':'overflow:hidden;position:relative;height:'+height+'px;width:'+width+'px'});
			var divOut2 = document.createElement('div');
			$(divOut2).attr('style','position:relative;left:0px;display:table-cell;vertical-align:middle;padding:4px;color:#fff;font-weight:bold;text-align:center;height:'+height+'px;width:'+width+'px');
			if($.browser.msie)
				$(divOut2).css({"filter":"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', src='images/monitor_glossy.png', sizingMethod='scale')"});
			else
				$(divOut2).css({'background':'url(images/monitor_glossy.png) top left no-repeat','-moz-background-size':'100% 100%','background-size':'100% 100%','-webkit-background-size':'100% 100%'});
			$(divOut2).html($('<div />').html(data.name).text()).appendTo(divOut1);
			$(divWrap).append(divOut1);

			// Set class for div so we get opacity
			if(data.state == 'Saved') {
				divWrap.addClass('vboxPreviewSaved');	
			} else {
				divWrap.removeClass('vboxPreviewSaved');
			}

			if((data.state == 'Running' || data.state == 'Saved') && $('#vboxIndex').data('vboxCookies')["vboxSectionShowPreview"] != 0) {

				__vboxDrawPreview();
								
			} else {
				
				// Clear timer if it is set
				if($('#vboxVMDetails').data('vboxPreviewTimer')) {
					window.clearTimeout($('#vboxVMDetails').data('vboxPreviewTimer'));
					$('#vboxVMDetails').data('vboxPreviewTimer', null);
				}
				
				
			}

			// Update 'View saved screenshot' menu item
			$('#vboxDetailsViewSavedSS').css('display',($('#vboxIndex').data('selectedVM').state == 'Saved' || $('#vboxIndex').data('selectedVM').state == 'Running' ? '' : 'none'));
		}
				

		
	}		


	
	// Display
	/////////////////////
	if(boxes) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));
		
		var vboxDetailsTable = $('#vboxDetailsTableBoxDisplay');
		$(vboxDetailsTable).find('tr.vboxDetailRow').empty().remove();

		if($('#vboxIndex').data('vboxCookies')["vboxSectionShowDisplay"] == 0) {
			$(vboxDetailsTable).hide();
		} else {
			$(vboxDetailsTable).show();
		}

	} else {
		$(vboxDetailsTable).append(__vboxDetailHeader('fullscreen_16px.png',"Display"));
	}
	 
	$(vboxDetailsTable).append(__vboxDetailRow(trans("Video Memory"), data['VRAMSize'] + " " + trans('MB')));
	
	// VRDE
	if(data['VRDEServer'] && data['VRDEServer']['VRDEExtPack'] && data['VRDEServer']['enabled'] && data['VRDEServer']['ports']) {
		if(data['VRDEServer']['netAddress']) {
			$(vboxDetailsTable).append(__vboxDetailRow(trans("Net Address"), data['VRDEServer']['netAddress']));
		}
		var chost = vboxGetVRDEAddress();
		
		if(links) {
			tr = __vboxDetailRow(trans("Server Port"), data['VRDEServer']['ports']);
			tr.childNodes[1].innerHTML = "<a href='rdp.php?host=" + chost + '&port=' + data['VRDEServer']['ports'] + "&vm=" + encodeURIComponent(data['name']) + "'>" + data['VRDEServer']['ports'] + "</a>";
			if(data['state'] == 'Running' && data['consolePort']) {
				tr.childNodes[1].innerHTML += ' (' + chost + ':' + data['consolePort'] + ')';
			}
			$(vboxDetailsTable).append(tr);
		} else {
			$(vboxDetailsTable).append(__vboxDetailRow(trans("Remote Console")+ ': ' +trans("Ports"), data['VRDEServer']['ports']));
		}
		
	}



	// Storage
	//////////////////////
	if(boxes) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));
		
		var vboxDetailsTable = $('#vboxDetailsTableBoxStorage');
		$(vboxDetailsTable).find('tr.vboxDetailRow').empty().remove();

		if($('#vboxIndex').data('vboxCookies')["vboxSectionShowStorage"] == 0) {
			$(vboxDetailsTable).hide();
		} else {
			$(vboxDetailsTable).show();
		}

	} else {
		$(vboxDetailsTable).append(__vboxDetailHeader('hd_16px.png',"Storage"));
	}

	var storage = new vboxStorage();
	
	for(var a = 0; a < data['storageControllers'].length; a++) {
		
		var con = data['storageControllers'][a];
		
		$(vboxDetailsTable).append(__vboxDetailRow(con.name, ''));
		
		data['storageControllers'][a]['mediumAttachments'].sort(function(a,b){
			if(a.port == b.port) {
				if(a.device < b.device) return -1;
				if(a.device > b.device) return 1;
				return 0;
			}
			if(a.port < b.port) return -1;
			return 1;
		});
		
		for(var b = 0; b < data['storageControllers'][a]['mediumAttachments'].length; b++) {
			
			var portName = storage[data['storageControllers'][a].bus].slotName(data['storageControllers'][a]['mediumAttachments'][b].port, data['storageControllers'][a]['mediumAttachments'][b].device);

			// Medium / host device info
			var medium = (data['storageControllers'][a]['mediumAttachments'][b].medium && data['storageControllers'][a]['mediumAttachments'][b].medium.id ? storage.getMediumById(data['storageControllers'][a]['mediumAttachments'][b].medium.id) : null);
			
			// Get base medium (snapshot -> virtual disk file)
			if(medium && medium.base && (medium.base != medium.id)) {
				medium = storage.getMediumById(medium.base);
			}


			portDesc = storage.mediumPrint(medium);

			// Link medium to mount?
			if(links && data['storageControllers'][a]['mediumAttachments'][b].type != 'HardDisk' && (data.state == 'Running' || (data.state == 'PoweredOff' && data.sessionState == 'Unlocked'))) {
				portDesc = $('<div />').text(portDesc).html();
				portDesc = '<a href="javascript:vboxMountInit(\''+data['id']+'\',\''+data['storageControllers'][a].bus+'\','+data['storageControllers'][a]['mediumAttachments'][b].port+','+data['storageControllers'][a]['mediumAttachments'][b].device+')">'+portDesc+'</a>';
			}
			$(vboxDetailsTable).append(__vboxDetailRowIndented(portName + (data['storageControllers'][a]['mediumAttachments'][b].type == 'DVD' ? ' (' + trans(data['storageControllers'][a]['mediumAttachments'][b].type) + ') ' : ''), portDesc,(data['storageControllers'][a]['mediumAttachments'][b].type != 'HardDisk' ? true : false)));
			
		}
		
	}


	// Audio
	////////////////////
	if(boxes) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));
		
		var vboxDetailsTable = $('#vboxDetailsTableBoxAudio');
		$(vboxDetailsTable).find('tr.vboxDetailRow').empty().remove();

		if($('#vboxIndex').data('vboxCookies')["vboxSectionShowAudio"] == 0) {
			$(vboxDetailsTable).hide();
		} else {
			$(vboxDetailsTable).show();
		}

	} else {
		$(vboxDetailsTable).append(__vboxDetailHeader('sound_16px.png',"Audio"));
	}
	
	if(!data['audioAdapter']['enabled']) {
		$(vboxDetailsTable).append(__vboxDetailRow('<span class="vboxDetailsNone">'+trans("Disabled")+'</span>', "", true));
	} else {
		$(vboxDetailsTable).append(__vboxDetailRow(trans("Host Audio Driver"), trans((data['audioAdapter']['audioDriver'] == 'Null' ? 'Null Audio Driver' : data['audioAdapter']['audioDriver'])))).append(__vboxDetailRow(trans("Audio Controller"), trans(data['audioAdapter']['audioController'])));
	}


	// Network
	///////////////////
	if(boxes) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));
		
		var vboxDetailsTable = $('#vboxDetailsTableBoxNetwork');
		$(vboxDetailsTable).find('tr.vboxDetailRow').empty().remove();

		if($('#vboxIndex').data('vboxCookies')["vboxSectionShowNetwork"] == 0) {
			$(vboxDetailsTable).hide();
		} else {
			$(vboxDetailsTable).show();
		}

	} else {
		$(vboxDetailsTable).append(__vboxDetailHeader('nw_16px.png',"Network"));
	}
	

	var vboxDetailsTableNics = 0;
	for(var i = 0; i < data['networkAdapters'].length; i++) {
		
		nic = data['networkAdapters'][i];
		
		// compose extra info
		var adp = '';

		if(nic.enabled) {
			vboxDetailsTableNics++;
			switch(nic.attachmentType) {
				case 'Null':
					adp = trans('Not attached');
					break;
				case 'Bridged':
					adp = trans('Bridged adapter, %s').replace('%s', nic.hostInterface);
					break;
				case 'HostOnly':
					adp = trans('Host-only adapter, \'%s\'').replace('%s', nic.hostInterface);
					break;
				case 'NAT':
					// 'NATNetwork' ?
					adp = trans('NAT');
					break;
				case 'Internal':
					adp = trans('Internal network, \'%s\'').replace('%s', nic.internalNetwork);
					break;
				case 'VDE':
					adp = trans('VDE network, \'%s\'').replace('%s', nic.VDENetwork);
					break;
			}

			$(vboxDetailsTable).append(__vboxDetailRow(trans("Adapter") + " " + (i + 1), trans(nic.adapterType) + ' (' + adp + ')'));
		}
				
	}
	
	if(vboxDetailsTableNics == 0) {
		$(vboxDetailsTable).append(__vboxDetailRow('<span class="vboxDetailsNone">'+trans('Disabled')+'</span>','',true));
		
	// Link nic to guest networking info?
	} else if(links && data['state'] == 'Running') {
		var n  = '<a href="javascript:vboxGuestNetworkAdaptersDialogInit(\''+data['id']+'\','+i+')">('+trans('Guest Network Adapters')+')</a>';
		$(vboxDetailsTable).append(__vboxDetailRow('',n,true));
	}

	// Serial Ports
	///////////////////
	if(boxes) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));
		
		var vboxDetailsTable = $('#vboxDetailsTableBoxSerialPorts');
		$(vboxDetailsTable).find('tr.vboxDetailRow').empty().remove();

		if($('#vboxIndex').data('vboxCookies')["vboxSectionShowSerialPorts"] == 0) {
			$(vboxDetailsTable).hide();
		} else {
			$(vboxDetailsTable).show();
		}

	} else {
		$(vboxDetailsTable).append(__vboxDetailHeader('serial_port_16px.png',"Serial Ports"));
	}
	

	var vboxDetailsTableSPorts = 0;
	var vboxSP = new vboxSerialPorts();
	for(var i = 0; i < data['serialPorts'].length; i++) {
		
		p = data['serialPorts'][i];
		
		if(!p.enabled) continue;
		
		// compose extra info
		var xtra = trans(vboxSP.getPortName(p.IRQ,p.IOBase));
		
		var mode = p.hostMode
		xtra += ', ' + trans(mode)
		if(mode != 'Disconnected') {
			xtra += ' (' + p.path + ')'
		}
		
		$(vboxDetailsTable).append(__vboxDetailRow(trans("Port X").replace('%s',(i + 1)), xtra));
		vboxDetailsTableSPorts++;
				
	}
	
	if(vboxDetailsTableSPorts == 0) {
		$(vboxDetailsTable).append(__vboxDetailRow('<span class="vboxDetailsNone">'+trans('Disabled')+'</span>','',true));		
	}


	// USB
	///////////////////
	if(boxes && data['USBController']) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));
		
		var vboxDetailsTable = $('#vboxDetailsTableBoxUSB');
		$(vboxDetailsTable).find('tr.vboxDetailRow').empty().remove();

		if($('#vboxIndex').data('vboxCookies')["vboxSectionShowUSB"] == 0) {
			$(vboxDetailsTable).hide();
		} else {
			$(vboxDetailsTable).show();
		}

	} else if(data['USBController']) {
		$(vboxDetailsTable).append(__vboxDetailHeader('usb_16px.png',"USB"));
	} else{
		$('#vboxDetailsTableBoxUSB').hide();
	}
	
		
	if(data['USBController'] && data['USBController']['enabled']) {
		var tot = 0;
		var act = 0;
		for(var i = 0; i < data['USBController'].deviceFilters.length; i++) {
			tot++;
			if(data['USBController'].deviceFilters[i].active) act++;
		}
		$(vboxDetailsTable).append(__vboxDetailRow(trans("Device Filters"), tot + ' (' + act + ' ' + trans('active') + ')'));
	} else if(data['USBController']) {
		$(vboxDetailsTable).append(__vboxDetailRow('<span class="vboxDetailsNone">'+trans("Disabled")+'</span>',"", true));
	}


	// Shared Folders
	////////////////////////
	if(boxes) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));
		
		var vboxDetailsTable = $('#vboxDetailsTableBoxSharedFolders');
		$(vboxDetailsTable).find('tr.vboxDetailRow').empty().remove();

		if($('#vboxIndex').data('vboxCookies')["vboxSectionShowSharedFolders"] == 0) {
			$(vboxDetailsTable).hide();
		} else {
			$(vboxDetailsTable).show();
		}

	} else {
		$(vboxDetailsTable).append(__vboxDetailHeader('shared_folder_16px.png',"Shared Folders"));
	}
	
	if(!data['sharedFolders'] || data['sharedFolders'].length < 1) {
		$(vboxDetailsTable).append(__vboxDetailRow('<span class="vboxDetailsNone">'+trans('None')+'</span>', '', true));
	} else {
		for(var i = 0; i < data['sharedFolders'].length; i++) {
			$(vboxDetailsTable).append(__vboxDetailRow(data['sharedFolders'][i].name + ' (' + trans(data['sharedFolders'][i].writable ? 'rw' : 'ro') + ')', data['sharedFolders'][i].hostPath));
		}
	}



	// Description
	////////////////////////
	if(boxes) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));
		
		var vboxDetailsTable = $('#vboxDetailsTableBoxDescription');
		$(vboxDetailsTable).find('tr.vboxDetailRow').empty().remove();

		if($('#vboxIndex').data('vboxCookies')["vboxSectionShowDescription"] == 0) {
			$(vboxDetailsTable).hide();
		} else {
			$(vboxDetailsTable).show();
		}

	} else {
		$(vboxDetailsTable).append(__vboxDetailHeader('description_16px.png',"Description"));
	}

	var dtr = document.createElement('tr');
	$(dtr).addClass('vboxDetailRow');
	var dtd = document.createElement('td');
	$(dtd).attr({'class':'vboxDetailDescriptionCell','colspan':'2'}).html(data.description.length ? $('<div />').html(data.description).text() : '<span class="vboxDetailsNone">'+trans("None")+'</span>').appendTo(dtr);
	$(vboxDetailsTable).append(dtr);
	
	// Append Table or show div
	if(boxes) {

		// append blank footer row
		$(vboxDetailsTable).append(__vboxDetailRow('',''));
		
		$('#vboxVMDetails').find('tr.vboxDetailsHead').children('th').each(function(){
			if($(this).data('vboxHidden')) {
				$(this).parent().siblings().css('display','none');
			} else {
				$(this).parent().siblings().css('display','');
			}
		});
		$('#vboxVMDetails').show();
	} else {
		$(targetdiv).append(vboxDetailsTable);
	}
	
	// Manually enable settings that are allowed to be changed while VM is running or saved
	if(links && data.state == 'Running') {
		$('#vboxDetailsTableBoxNetwork').find('div').removeClass('vboxNoLinks');
		$('#vboxDetailsTableBoxSharedFolders').find('div').removeClass('vboxNoLinks');
		if(data['USBController'] && data['USBController']['enabled']) {
			$('#vboxDetailsTableBoxUSB').find('div').removeClass('vboxNoLinks');
		}
	}
}

//Display details data for VirtualBox Host
/////////////////////////////////////////////
function __vboxDisplayHostDetailsData(data) {
	

	// clear progress bar or existing data
	$('#vboxHostDetails').html('');
	
	// Details Table
	var vboxDetailsTable = document.createElement('table');
	vboxDetailsTable.setAttribute('class','vboxDetailsTable');
	vboxDetailsTable.setAttribute('class','vboxDetailsTable vboxDetailsTableBox ui-corner-all');

	// General
	$(vboxDetailsTable).append(__vboxDetailHeader("machine_16px.png",trans("General"),null,null,true));
	if($('#vboxIndex').data('vboxConfig').servers.length) $(vboxDetailsTable).append(__vboxDetailRow(trans("Name"), $('#vboxIndex').data('vboxConfig').name));	
	$(vboxDetailsTable).append(__vboxDetailRow(trans("OS Type"), data['operatingSystem'] + ' (' + data['OSVersion'] +')')).append(__vboxDetailRow("VirtualBox", $('#vboxIndex').data('vboxConfig').version.string+' ('+$('#vboxIndex').data('vboxConfig').version.revision+')')).append(__vboxDetailRow(trans("Base Memory"), data['memorySize'] + ' ' + trans('MB'))).append(__vboxDetailRow(trans("Processors"), data['cpus'][0] + ' (' + data['cpus'].length +')'));

	$(vboxDetailsTable).append(__vboxDetailRow('',''));
	$('#vboxHostDetails').append(vboxDetailsTable);
	
	// Network
	var vboxDetailsTable = document.createElement('table');
	$(vboxDetailsTable).attr({'class':'vboxDetailsTable vboxDetailsTableBox ui-corner-all'}).append(__vboxDetailHeader("nw_16px.png",trans("Network"),null,null,true));

	for(var i = 0; i < data['networkInterfaces'].length; i++) {		
		
		$(vboxDetailsTable).append(__vboxDetailRow(data['networkInterfaces'][i].name + ' (' + trans(data['networkInterfaces'][i].status) + ')','')).append(__vboxDetailRowIndented(trans('IPv4Addr'), data['networkInterfaces'][i].IPAddress + ' / ' + data['networkInterfaces'][i].networkMask));
		
		if(data['networkInterfaces'][i].IPV6Supported) {
			$(vboxDetailsTable).append(__vboxDetailRowIndented(trans('IPv6Addr'), data['networkInterfaces'][i].IPV6Address + ' / ' + data['networkInterfaces'][i].IPV6NetworkMaskPrefixLength));
		}
		$(vboxDetailsTable).append(__vboxDetailRowIndented(trans('netMediumType'),trans(data['networkInterfaces'][i].mediumType) + (data['networkInterfaces'][i].hardwareAddress ? ' (' + data['networkInterfaces'][i].hardwareAddress + ')' : '')));
	}

	
	// Append Table
	$(vboxDetailsTable).append(__vboxDetailRow('',''));
	$('#vboxHostDetails').append(vboxDetailsTable).show();
}


/*
 *
 * Show / Hide boxes menu
 *
 */
var ul = document.createElement('ul');
$(ul).attr({'class':'contextMenu contextMenuNoBG','style':'display: none','id':'vboxDetailsShowMenu'});
var sections = new Array('General','System','Preview','Display','Storage','Audio','Network','Serial Ports','USB','Shared Folders','Description');
for(var i = 0; i < sections.length; i++) {

	
	// Preview is not enabled?
	if($('#vboxIndex').data('vboxConfig').noPreview && sections[i] == 'Preview')
		continue;

	// checked?
	var checked = 'checked';
	if($('#vboxIndex').data('vboxCookies')["vboxSectionShow"+sections[i].replace(' ','')] == 0)
		checked = '';
	
	var li = document.createElement('li');
	var cb = document.createElement('input');
	$(cb).attr({'type':'checkbox','class':'vboxCheckbox','name':sections[i].replace(' ',''),'checked':checked}).click(function(){

		vboxSetCookie("vboxSectionShow"+$(this).attr('name'),(this.checked ? 1 : 0));
		$('#vboxDetailsTableBox'+$(this).attr('name')).css('display',(this.checked ? '' : 'none'));
		$('#vboxIndex').data('vboxCookies')["vboxSectionShow"+$(this).attr('name')] = (this.checked ? 1 : 0);

		// Special case for Preview
		if($(this).attr('name') == 'Preview') {
			if(this.checked && $('#vboxIndex').data('selectedVM').id != 'host') {
				$('#vboxDetailsTableBoxPreviewSpacer').show();
				__vboxDrawPreview();
			} else {
				$('#vboxDetailsTableBoxPreviewSpacer').hide();
				// Clear timer if it is set
				if($('#vboxVMDetails').data('vboxPreviewTimer')) {
					window.clearTimeout($('#vboxVMDetails').data('vboxPreviewTimer'));
					$('#vboxVMDetails').data('vboxPreviewTimer', null);
				}
			}				
		}
		
	});
	$(li).append(cb);
	var sp = document.createElement('span');
	$(sp).append(' ' + trans(sections[i]));
	$(li).append(sp);
	$(ul).append(li);
}
$('#vboxIndex').append(ul);
$('#vboxDetailsShowMenu').bind('contextmenu', function() { return false; })


/*
 * 
 * Preivew Update Menu
 *
 */
// determine default
if($('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] === undefined) {
	if($('#vboxIndex').data('vboxConfig').previewUpdateInterval)
		$('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] = $('#vboxIndex').data('vboxConfig').previewUpdateInterval;
	else
		$('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] = 3;
}
var ul = document.createElement('ul');
$(ul).attr({'class':'contextMenu contextMenuNoBG','style':'display: none','id':'vboxDetailsPreviewMenu'}).click(function(){$(this).hide();});
var radio = document.createElement('input');
$(radio).attr({'class':'vboxRadio','type':'radio','name':'vboxPreviewRadio','value':0}).click(function(){
	$('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] = 0;
	vboxSetCookie("vboxPreviewUpdate","0");
});
if($('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] == 0) {
	$(radio).attr('checked','checked');
}
var li = document.createElement('li');
$(li).hover(function(){
	$(this).addClass('hover');
},function(){
	$(this).removeClass('hover');
}).append(radio);

var sp = document.createElement('span');
$(sp).html(trans('Update Disabled')).click(function(){$(this).siblings('input').click();});
$(li).append(sp);
$(ul).append(li);
var ints = [1,3,5,10,20];
// check for update interval
if($('#vboxIndex').data('vboxConfig').previewUpdateInterval && jQuery.inArray($('#vboxIndex').data('vboxConfig').previewUpdateInterval, ints) < 0) {
	ints[ints.length] = $('#vboxIndex').data('vboxConfig').previewUpdateInterval;
}
if($('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] && $('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] > 0 && jQuery.inArray(parseInt($('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"]), ints) < 0) {
	ints[ints.length] = $('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"];
}
ints.sort(function(a,b){
	if(a == b) return 0;
	return (a > b ? 1 : -1);
});

for(var i = 0; i < ints.length; i++) {
	var radio = document.createElement('input');
	$(radio).attr({'class':'vboxRadio','type':'radio','name':'vboxPreviewRadio','value':ints[i]}).click(function(){
		vboxSetCookie("vboxPreviewUpdate",$(this).val());		
		$('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] = $(this).val();
		__vboxDrawPreview();
	});

	if($('#vboxIndex').data('vboxCookies')["vboxPreviewUpdate"] == ints[i])
		$(radio).attr('checked','checked');
	
	var li = document.createElement('li');
	if(i==0) $(li).attr('class','separator');
	$(li).append(radio).hover(function(){
		$(this).addClass('hover');
	},function(){
		$(this).removeClass('hover');
	});
	var sp = document.createElement('span');
	$(sp).html(trans('Every X seconds').replace('%s',ints[i])).click(function(){
		$(this).siblings('input').click();
	}).appendTo(li);
	$(ul).append(li);
	if(i == (ints.length - 1)) {
		var li = document.createElement('li');
		$(li).attr({'id':'vboxDetailsViewSavedSS','class':'separator','style':'display:none;text-align: center;'}).hover(function(){
			$(this).addClass('hover');
		},function(){
			$(this).removeClass('hover');
		}).click(function(){
			var newwin = window.open('screen.php?vm='+$('#vboxIndex').data('selectedVM').id+'&full=1','vboxSC','toolbar=1,menubar=0,location=0,directories=0,status=true,resize=true');
		});
		var sp = document.createElement('sp');
		$(sp).html(trans('Open in new window'));
		$(li).append(sp);
		$(ul).append(li);
	}
}
$('#vboxIndex').append(ul);
$(ul).bind('contextmenu', function() { return false; })


/* Menu functionality */
$("#vboxVMDetails").mouseup( function(e) {

	if(e.button == 2) {

		// Check for right click over preview window
		var pos = $('#vboxDetailsPreviewWrap').offset();
		var w = $('#vboxDetailsPreviewWrap').outerWidth(false);
		var h = $('#vboxDetailsPreviewWrap').outerHeight(false);

		if(pos && e.pageX > 0 && e.pageX >= pos.left && e.pageX <= (pos.left + w) && e.pageY >= pos.top && e.pageY <= (pos.top+h)) {
			var menu = $('#vboxDetailsPreviewMenu');
			$('#vboxDetailsShowMenu').hide();
		} else {
			var menu = $('#vboxDetailsShowMenu');
			$('#vboxDetailsPreviewMenu').hide();
		}
		vboxPositionEvent(menu, e);
		$(menu).show();
		
		e.preventDefault();
		e.stopPropagation();

		return false;
		
	} else {
		$('#vboxDetailsShowMenu').hide();
		$('#vboxDetailsPreviewMenu').hide();
	}
});
$("#vboxVMDetails").bind('contextmenu', function() { return false; }).bind('click',function(e){return e.button!=2;});

</script>
</div>